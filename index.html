<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>S.A.R.D — Interactive Teardown</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden;background:#06080f;color:#e8ecf4;font-family:'Outfit',sans-serif;-webkit-font-smoothing:antialiased}

/* ═══ LOADER ═══ */
#loader{position:fixed;inset:0;z-index:200;background:#06080f;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1.5rem;transition:opacity .8s,visibility .8s}
#loader.done{opacity:0;visibility:hidden;pointer-events:none}
.ld-hex{width:50px;height:50px;position:relative;animation:ldrot 3s linear infinite}
.ld-hex::before,.ld-hex::after{content:'';position:absolute;inset:0;border:2px solid transparent;border-top-color:#fbbf24;border-radius:50%}
.ld-hex::after{inset:6px;border-top-color:transparent;border-bottom-color:rgba(6,182,212,.6);animation:ldrot 1.5s linear reverse infinite}
@keyframes ldrot{to{transform:rotate(360deg)}}
.ld-text{font-family:'JetBrains Mono',monospace;font-size:.6rem;color:#fbbf24;letter-spacing:4px;text-transform:uppercase}
.ld-bar{width:160px;height:1.5px;background:rgba(255,255,255,.06);border-radius:2px;overflow:hidden}
.ld-fill{height:100%;width:0%;background:linear-gradient(90deg,#fbbf24,#06b6d4);transition:width .2s}

/* ═══ 3D CANVAS ═══ */
#viewport{position:fixed;inset:0;z-index:1}
#viewport canvas{display:block;width:100%!important;height:100%!important}

/* ═══ SCROLL DRIVER (hidden, wheel-driven) ═══ */

/* ═══ UI OVERLAY ═══ */
#ui{position:fixed;inset:0;z-index:50;pointer-events:none;overflow:hidden}

/* Top bar */
.bar{position:absolute;top:0;left:0;right:0;padding:1.4rem 2rem;display:flex;justify-content:space-between;align-items:center}
.bar-l{display:flex;align-items:center;gap:.7rem}
.dot{width:5px;height:5px;background:#fbbf24;border-radius:50%;box-shadow:0 0 8px rgba(251,191,36,.6);animation:pulse 2s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.3;transform:scale(.7)}}
.lbl{font-family:'JetBrains Mono',monospace;font-size:.55rem;font-weight:600;color:#fbbf24;letter-spacing:2.5px;text-transform:uppercase}
.pct{font-family:'JetBrains Mono',monospace;font-size:.55rem;color:#3a4a66;letter-spacing:1.5px;transition:color .3s}

/* Hero */
.hero{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;width:85%;max-width:600px;pointer-events:none}
.hero h1{font-size:clamp(2.2rem,5.5vw,4.2rem);font-weight:800;letter-spacing:-.04em;line-height:1.05;background:linear-gradient(135deg,#ffffff 20%,#fbbf24 60%,#06b6d4 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:.7rem}
.hero p{font-size:clamp(.85rem,1.3vw,1.05rem);font-weight:300;color:#6b7fa3;line-height:1.65}

/* Bottom info */
.info{position:absolute;bottom:0;left:0;right:0;padding:0 2rem 1.8rem;display:flex;justify-content:space-between;align-items:flex-end;opacity:0;transition:opacity .5s}
.info-txt{max-width:420px}
.info-tag{font-family:'JetBrains Mono',monospace;font-size:.55rem;font-weight:600;color:#fbbf24;letter-spacing:2.5px;text-transform:uppercase;margin-bottom:.4rem}
.info-h{font-size:clamp(1.1rem,2vw,1.6rem);font-weight:700;letter-spacing:-.02em;margin-bottom:.3rem}
.info-d{font-size:.82rem;font-weight:300;color:#6b7fa3;line-height:1.65}

/* Rail */
.rail{display:flex;flex-direction:column;align-items:center;gap:.6rem}
.rail-t{width:1.5px;height:160px;background:rgba(255,255,255,.04);border-radius:2px;position:relative}
.rail-f{position:absolute;top:0;left:0;width:100%;height:0%;background:linear-gradient(180deg,#fbbf24,#06b6d4);border-radius:2px;box-shadow:0 0 12px rgba(251,191,36,.4)}
.rail-h{position:absolute;left:50%;top:0%;transform:translate(-50%,-50%);width:8px;height:8px;background:#fbbf24;border-radius:50%;box-shadow:0 0 10px rgba(251,191,36,.5)}
.rail-p{font-family:'JetBrains Mono',monospace;font-size:.55rem;color:#3a4a66}

/* Scroll cue */
.cue{position:absolute;bottom:1.8rem;left:50%;transform:translateX(-50%);display:flex;flex-direction:column;align-items:center;gap:.4rem;animation:bob 2.5s ease-in-out infinite}
.cue span{font-family:'JetBrains Mono',monospace;font-size:.45rem;color:#3a4a66;letter-spacing:3px;text-transform:uppercase}
.cue-arr{width:10px;height:10px;border-right:1.5px solid #3a4a66;border-bottom:1.5px solid #3a4a66;transform:rotate(45deg)}
@keyframes bob{0%,100%{transform:translateX(-50%) translateY(0);opacity:.3}50%{transform:translateX(-50%) translateY(6px);opacity:1}}

/* Callouts */
.cl{position:absolute;display:flex;align-items:center;gap:4px;opacity:0;transform:translateX(8px);transition:opacity .35s,transform .35s;pointer-events:none}
.cl.on{opacity:1;transform:translateX(0)}
.cl-dot{width:4px;height:4px;background:#fbbf24;border-radius:50%;box-shadow:0 0 5px rgba(251,191,36,.5);flex-shrink:0}
.cl-line{width:18px;height:1px;background:linear-gradient(90deg,#fbbf24,transparent);flex-shrink:0}
.cl-box{background:rgba(12,18,32,.85);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid rgba(251,191,36,.18);border-radius:3px;padding:3px 7px}
.cl-name{font-family:'JetBrains Mono',monospace;font-size:.5rem;font-weight:700;color:#fbbf24;letter-spacing:1.5px;text-transform:uppercase}
.cl-desc{font-size:.45rem;color:#6b7fa3;margin-top:1px}

@media(max-width:768px){
  .bar{padding:1rem 1rem}
  .info{padding:0 1rem 1.2rem;flex-direction:column;gap:.8rem;align-items:flex-start}
  .rail{display:none}
  .hero h1{font-size:2rem}
}
</style>
</head>
<body>

<div id="loader">
  <div class="ld-hex"></div>
  <div class="ld-text" id="ldT">Initializing S.A.R.D</div>
  <div class="ld-bar"><div class="ld-fill" id="ldF"></div></div>
</div>

<div id="viewport"></div>

<div id="ui">
  <div class="bar">
    <div class="bar-l"><div class="dot"></div><span class="lbl">S.A.R.D // Teardown</span></div>
    <span class="pct" id="uPct">0.0%</span>
  </div>

  <div class="hero" id="uHero">
    <h1>What's inside<br>S.A.R.D?</h1>
    <p>Scroll to slice through the airframe and explore the avionics, AI processor, and sensor suite inside a $476 surveillance drone.</p>
  </div>

  <div class="info" id="uInfo">
    <div class="info-txt">
      <div class="info-tag" id="uTag">01 // Exterior</div>
      <div class="info-h" id="uHead">Airframe Shell</div>
      <div class="info-d" id="uDesc">DXW 500mm wheelbase multi-rotor airframe.</div>
    </div>
    <div class="rail">
      <div class="rail-t"><div class="rail-f" id="uRF"></div><div class="rail-h" id="uRH"></div></div>
      <div class="rail-p" id="uRP">0%</div>
    </div>
  </div>

  <div class="cue" id="uCue"><span>Scroll to dissect</span><div class="cue-arr"></div></div>
</div>

<script type="importmap">
{"imports":{
  "three":"https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
  "three/addons/":"https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
}}
</script>
<script type="module">
import * as THREE from 'three';
import {GLTFLoader} from 'three/addons/loaders/GLTFLoader.js';
import {OrbitControls} from 'three/addons/controls/OrbitControls.js';

/* ═══════════════════════════════════════
   CONFIG
   ═══════════════════════════════════════ */
const MODEL_URL = 'https://raw.githubusercontent.com/Aryaa207/sard-assets/main/drone_optimized_v3.glb';
const Y_TOP = 0.24, Y_BOT = -0.22;
const LERP = 0.06;

const COMPS = [
  {n:'Arducam 64MP',d:'High-res optical',p:[.15,.16,.18],s:.06,h:.30},
  {n:'OV2659',d:'2MP secondary',p:[-.18,.15,.12],s:.06,h:.30},
  {n:'GPS NEO-6M',d:'Navigation',p:[0,.12,-.16],s:.15,h:.42},
  {n:'LSM9DS1 IMU',d:'9-axis inertial',p:[-.12,.06,0],s:.25,h:.55},
  {n:'Arduino Nano',d:'Sensor fusion',p:[.13,.02,-.08],s:.35,h:.65},
  {n:'RPi 4B',d:'Edge AI / ML',p:[-.06,-.01,.10],s:.42,h:.72},
  {n:'KK2.1.5 FC',d:'Flight PID',p:[0,-.05,0],s:.50,h:.80},
  {n:'ESC Array',d:'Motor control',p:[.22,-.06,.20],s:.52,h:.82},
  {n:'3S LiPo',d:'2200mAh power',p:[0,-.13,0],s:.62,h:.92},
];

const SECS = [
  {at:0,  n:'01',l:'Exterior',t:'Airframe Shell',d:'DXW multi-rotor airframe, 500mm wheelbase. Optimized for payload capacity and flight stability.'},
  {at:.08,n:'02',l:'Optics',t:'Dual Camera Module',d:'Arducam 64MP for AI facial detection. OV2659 for secondary surveillance. Full 360° coverage.'},
  {at:.22,n:'03',l:'Navigation',t:'Sensors & Telemetry',d:'NEO-6M GPS with 2.5m CEP. LSM9DS1 IMU feeds Extended Kalman Filter for attitude estimation.'},
  {at:.38,n:'04',l:'Compute',t:'Processing Core',d:'Raspberry Pi 4B runs YuNet DNN — ~100 face detections/frame. Arduino Nano handles sensor fusion.'},
  {at:.52,n:'05',l:'Flight',t:'Control Systems',d:'KK2.1.5 with tuned PID gains. ESC array drives brushless motors at 2.4:1 thrust-to-weight.'},
  {at:.68,n:'06',l:'Power',t:'Energy System',d:'Zeee 3S LiPo 2200mAh. 7–10 min endurance with full payload and active AI processing.'},
  {at:.88,n:'07',l:'Complete',t:'Full Cross-Section',d:'Dual-controller avionics — edge AI, sensor fusion, autonomous tracking. Total cost: $476.'},
];

/* ═══════════════════════════════════════
   RENDERER
   ═══════════════════════════════════════ */
const vp = document.getElementById('viewport');
const W = () => vp.clientWidth, H = () => vp.clientHeight;

const renderer = new THREE.WebGLRenderer({antialias:true, alpha:false, powerPreference:'high-performance'});
renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
renderer.setSize(W(), H());
renderer.outputColorSpace = THREE.SRGBColorSpace;
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 1.1;
renderer.localClippingEnabled = true;
vp.appendChild(renderer.domElement);

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x06080f);
scene.fog = new THREE.FogExp2(0x06080f, 0.8);

const cam = new THREE.PerspectiveCamera(34, W()/H(), 0.01, 50);
cam.position.set(0.85, 0.35, 0.95);

const ctrl = new OrbitControls(cam, renderer.domElement);
ctrl.enableDamping = true; ctrl.dampingFactor = 0.06;
ctrl.enablePan = false; ctrl.minDistance = 0.4; ctrl.maxDistance = 2.2;
ctrl.target.set(0, 0.02, 0);
ctrl.autoRotate = true; ctrl.autoRotateSpeed = 0.4;

/* ═══════════════════════════════════════
   LIGHTS
   ═══════════════════════════════════════ */
scene.add(new THREE.AmbientLight(0x4a6fa5, 0.6));
const keyL = new THREE.DirectionalLight(0xffeedd, 0.9); keyL.position.set(3, 5, 3); scene.add(keyL);
const fillL = new THREE.DirectionalLight(0x06b6d4, 0.35); fillL.position.set(-4, 2, -2); scene.add(fillL);
const rimL = new THREE.DirectionalLight(0xfbbf24, 0.25); rimL.position.set(0, -1, -4); scene.add(rimL);
const cutL = new THREE.PointLight(0xfbbf24, 0, 0.8, 2); scene.add(cutL);

/* ═══════════════════════════════════════
   CLIPPING PLANE & GLOW RING
   ═══════════════════════════════════════ */
const clipPlane = new THREE.Plane(new THREE.Vector3(0, -1, 0), Y_TOP);

const glowGroup = new THREE.Group(); scene.add(glowGroup);

// Pulsing glow ring shader
const glowMat = new THREE.ShaderMaterial({
  transparent: true, depthWrite: false, side: THREE.DoubleSide,
  uniforms: { uAlpha: {value: 0}, uTime: {value: 0} },
  vertexShader: `varying vec3 vP; void main(){ vP = position; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }`,
  fragmentShader: `
    uniform float uAlpha, uTime;
    varying vec3 vP;
    void main(){
      float r = length(vP.xz);
      float ring = exp(-pow((r - 0.24) * 16.0, 2.0));
      float glow = exp(-pow((r - 0.24) * 5.0, 2.0)) * 0.3;
      float pulse = 0.7 + 0.3 * sin(uTime * 2.5);
      vec3 col = mix(vec3(0.984, 0.749, 0.141), vec3(0.024, 0.714, 0.831), smoothstep(0.15, 0.35, r));
      gl_FragColor = vec4(col, (ring + glow) * uAlpha * pulse);
    }
  `
});
glowGroup.add(new THREE.Mesh(new THREE.PlaneGeometry(1.4, 1.4), glowMat));
glowGroup.children[0].rotation.x = -Math.PI / 2;

// Thin bright ring
const ringMat = new THREE.MeshBasicMaterial({color: 0xfbbf24, transparent: true, opacity: 0, side: THREE.DoubleSide, depthWrite: false});
const ring = new THREE.Mesh(new THREE.RingGeometry(0.21, 0.24, 96), ringMat);
ring.rotation.x = -Math.PI / 2;
glowGroup.add(ring);

// Dark cap for cross-section interior
const capMat = new THREE.MeshStandardMaterial({color: 0x0a1628, metalness: 0.6, roughness: 0.3, side: THREE.DoubleSide, transparent: true, opacity: 0});
const cap = new THREE.Mesh(new THREE.CircleGeometry(0.5, 64), capMat);
cap.rotation.x = -Math.PI / 2;
glowGroup.add(cap);

/* ═══════════════════════════════════════
   HOLOGRAPHIC SHADER
   ═══════════════════════════════════════ */
const holoMaterial = new THREE.ShaderMaterial({
  clippingPlanes: [clipPlane],
  clipShadows: true,
  side: THREE.DoubleSide,
  transparent: true,
  uniforms: {
    uTime: { value: 0 },
    uBaseColor: { value: new THREE.Color(0.95, 0.75, 0.15) },  // gold
    uEdgeColor: { value: new THREE.Color(0.02, 0.71, 0.83) },  // cyan
    uFresnelPow: { value: 2.5 },
    uOpacity: { value: 0.88 },
    uScanSpeed: { value: 0.4 },
  },
  vertexShader: `
    varying vec3 vNormal;
    varying vec3 vViewDir;
    varying vec3 vWorldPos;

    void main() {
      vec4 worldPos = modelMatrix * vec4(position, 1.0);
      vWorldPos = worldPos.xyz;
      vNormal = normalize(normalMatrix * normal);
      vViewDir = normalize(cameraPosition - worldPos.xyz);
      gl_Position = projectionMatrix * viewMatrix * worldPos;
    }
  `,
  fragmentShader: `
    uniform float uTime;
    uniform vec3 uBaseColor;
    uniform vec3 uEdgeColor;
    uniform float uFresnelPow;
    uniform float uOpacity;
    uniform float uScanSpeed;

    varying vec3 vNormal;
    varying vec3 vViewDir;
    varying vec3 vWorldPos;

    void main() {
      // Fresnel — edges glow cyan, face glows gold
      float fresnel = pow(1.0 - max(dot(vNormal, vViewDir), 0.0), uFresnelPow);
      vec3 color = mix(uBaseColor, uEdgeColor, fresnel);

      // Subtle scanline effect
      float scan = sin(vWorldPos.y * 80.0 - uTime * uScanSpeed) * 0.5 + 0.5;
      scan = smoothstep(0.3, 0.7, scan);

      // Horizontal scan band (moves up slowly)
      float band = exp(-pow((vWorldPos.y - sin(uTime * 0.3) * 0.15) * 8.0, 2.0)) * 0.15;

      // Base lighting
      float diffuse = max(dot(vNormal, normalize(vec3(3.0, 5.0, 3.0))), 0.0);
      float ambient = 0.35;
      float light = ambient + diffuse * 0.65;

      // Combine
      float alpha = uOpacity * light;
      alpha += fresnel * 0.3;  // edges brighter
      alpha *= (0.85 + scan * 0.15);  // scanline modulation
      color += vec3(band);  // scan band highlight

      gl_FragColor = vec4(color * light + fresnel * uEdgeColor * 0.4, clamp(alpha, 0.0, 1.0));
    }
  `
});

/* ═══════════════════════════════════════
   LOAD MODEL
   ═══════════════════════════════════════ */
const loader = new GLTFLoader();
loader.load(
  MODEL_URL,
  (gltf) => {
    gltf.scene.traverse(child => {
      if (child.isMesh) {
        child.material = holoMaterial;
      }
    });
    scene.add(gltf.scene);
    document.getElementById('loader').classList.add('done');
  },
  (xhr) => {
    if (xhr.total) {
      const pct = (xhr.loaded / xhr.total * 100);
      document.getElementById('ldF').style.width = pct + '%';
      document.getElementById('ldT').textContent = pct < 100 ? 'Loading mesh data' : 'Compiling shaders';
    }
  },
  (err) => {
    console.error('GLB load error:', err);
    document.getElementById('ldT').textContent = 'LOAD FAILED';
    document.getElementById('ldT').style.color = '#f44';
  }
);

/* ═══════════════════════════════════════
   CALLOUT ELEMENTS
   ═══════════════════════════════════════ */
const uiEl = document.getElementById('ui');
const callouts = COMPS.map(c => {
  const el = document.createElement('div');
  el.className = 'cl';
  el.innerHTML = `<div class="cl-dot"></div><div class="cl-line"></div><div class="cl-box"><div class="cl-name">${c.n}</div><div class="cl-desc">${c.d}</div></div>`;
  uiEl.appendChild(el);
  return { el, cfg: c, pos3: new THREE.Vector3(...c.p) };
});

/* ═══════════════════════════════════════
   UI REFS
   ═══════════════════════════════════════ */
const $pct = document.getElementById('uPct');
const $hero = document.getElementById('uHero');
const $info = document.getElementById('uInfo');
const $cue = document.getElementById('uCue');
const $tag = document.getElementById('uTag');
const $head = document.getElementById('uHead');
const $desc = document.getElementById('uDesc');
const $rF = document.getElementById('uRF');
const $rH = document.getElementById('uRH');
const $rP = document.getElementById('uRP');

/* ═══════════════════════════════════════
   SCROLL STATE — Wheel-driven, no spacer
   ═══════════════════════════════════════ */
let target = 0, current = 0, secIdx = -1;

// Use wheel events for scroll — works inside iframes and Squarespace
window.addEventListener('wheel', (e) => {
  e.preventDefault();
  target += e.deltaY * 0.0004;
  target = Math.max(0, Math.min(1, target));
}, { passive: false });

// Touch support
let touchY = 0;
window.addEventListener('touchstart', (e) => { touchY = e.touches[0].clientY; }, { passive: true });
window.addEventListener('touchmove', (e) => {
  const dy = touchY - e.touches[0].clientY;
  touchY = e.touches[0].clientY;
  target += dy * 0.002;
  target = Math.max(0, Math.min(1, target));
  e.preventDefault();
}, { passive: false });

/* ═══════════════════════════════════════
   UPDATE
   ═══════════════════════════════════════ */
function update(t) {
  // Clipping plane
  const y = Y_TOP - t * (Y_TOP - Y_BOT);
  clipPlane.constant = y;
  glowGroup.position.y = y;

  // Effects visibility
  const active = t > 0.005 && t < 0.97;
  const a = active ? 1 : 0;
  glowMat.uniforms.uAlpha.value = a;
  ringMat.opacity = a * 0.7;
  capMat.opacity = a * 0.5;
  cutL.position.set(0, y, 0);
  cutL.intensity = a * 1.8;

  // UI
  const pc = (t * 100) | 0;
  $pct.textContent = (t * 100).toFixed(1) + '%';
  $pct.style.color = t > 0.01 ? '#fbbf24' : '#3a4a66';
  $rF.style.height = pc + '%';
  $rH.style.top = pc + '%';
  $rP.textContent = pc + '%';

  // Hero / info transition
  if (t < 0.035) {
    const f = t / 0.035;
    $hero.style.opacity = 1 - f;
    $hero.style.transform = `translate(-50%, ${-50 - f * 30}%)`;
    $info.style.opacity = 0;
    $cue.style.opacity = 1 - f;
  } else {
    $hero.style.opacity = 0;
    $info.style.opacity = 1;
    $cue.style.opacity = 0;
  }

  // Section text
  let idx = 0;
  for (let i = SECS.length - 1; i >= 0; i--) {
    if (t >= SECS[i].at) { idx = i; break; }
  }
  if (idx !== secIdx) {
    secIdx = idx;
    const s = SECS[idx];
    $tag.textContent = s.n + ' // ' + s.l;
    $head.textContent = s.t;
    $desc.textContent = s.d;
  }

  // Callouts
  const hw = W() / 2, hh = H() / 2;
  callouts.forEach(({ el, cfg, pos3 }) => {
    if (t >= cfg.s && t <= cfg.h) {
      const projected = pos3.clone().project(cam);
      const sx = projected.x * hw + hw;
      const sy = -projected.y * hh + hh;
      if (projected.z < 1 && sx > 20 && sx < W() - 20 && sy > 20 && sy < H() - 20) {
        el.style.left = sx + 'px';
        el.style.top = sy + 'px';
        el.classList.add('on');
      } else {
        el.classList.remove('on');
      }
    } else {
      el.classList.remove('on');
    }
  });
}

/* ═══════════════════════════════════════
   RENDER LOOP
   ═══════════════════════════════════════ */
const clock = new THREE.Clock();

(function animate() {
  requestAnimationFrame(animate);

  const elapsed = clock.getElapsedTime();

  // Smooth scroll interpolation
  current += (target - current) * LERP;
  if (Math.abs(current - target) < 0.00003) current = target;

  // Update shader uniforms
  holoMaterial.uniforms.uTime.value = elapsed;
  glowMat.uniforms.uTime.value = elapsed;

  update(current);
  ctrl.update();
  renderer.render(scene, cam);
})();

/* ═══════════════════════════════════════
   RESIZE
   ═══════════════════════════════════════ */
window.addEventListener('resize', () => {
  cam.aspect = W() / H();
  cam.updateProjectionMatrix();
  renderer.setSize(W(), H());
});
</script>
</body>
</html>
